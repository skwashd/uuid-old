<?php

module_load_include('inc', 'uuid');

/**
 * Implements hook_node_presave().
 */
function uuid_node_node_presave($node) {
  if (!$node->nid) {
    $node->uuid = uuid_uuid();
    $node->vuuid = uuid_uuid();
  }
  else {
    $old_node = node_load($node->nid);
    if ($old_node->vid != $node->vid) {
      $node->vuuid = uuid_uuid();
    }
  }
}

